(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/login"],{67:function(e,t,n){"use strict";(function(e){n(5),n(6);o(n(4));var t=o(n(68));function o(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=n,e(t.default)}).call(this,n(1)["createPage"])},68:function(e,t,n){"use strict";n.r(t);var o=n(69),i=n(71);for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);n(73);var s,r=n(25),c=Object(r["default"])(i["default"],o["render"],o["staticRenderFns"],!1,null,null,null,!1,o["components"],s);c.options.__file="pages/login/login.vue",t["default"]=c.exports},69:function(e,t,n){"use strict";n.r(t);var o=n(70);n.d(t,"render",(function(){return o["render"]})),n.d(t,"staticRenderFns",(function(){return o["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return o["recyclableRender"]})),n.d(t,"components",(function(){return o["components"]}))},70:function(e,t,n){"use strict";var o;n.r(t),n.d(t,"render",(function(){return i})),n.d(t,"staticRenderFns",(function(){return s})),n.d(t,"recyclableRender",(function(){return a})),n.d(t,"components",(function(){return o}));var i=function(){var e=this,t=e.$createElement;e._self._c},a=!1,s=[];i._withStripped=!0},71:function(e,t,n){"use strict";n.r(t);var o=n(72),i=n.n(o);for(var a in o)"default"!==a&&function(e){n.d(t,e,(function(){return o[e]}))}(a);t["default"]=i.a},72:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;o(n(27)),n(21);function o(e){return e&&e.__esModule?e:{default:e}}getApp();var i=function(){n.e("components/wybar/wyBar").then(function(){return resolve(n(542))}.bind(null,n)).catch(n.oe)},a={components:{wybar:i},data:function(){return{top:0,closeTop:0,loginType:!0,codetimes:"获取验证码",timer:null,canshowcode:!1,passwordFocus:!1,codeFocus:!1,agree:!1,mobile:"",password:"",phone:"",code:"",unionid:"",nickName:"",avatar:"",thirdArray:[],countryCode:"+86"}},onShow:function(){var t=this;e.getStorage({key:"countryCode",success:function(e){t.countryCode=e.data,console.log(e)}})},onUnload:function(){clearInterval(this.timer),this.timer=null},onLoad:function(e){this.top=getApp().globalData.top+20,this.closeTop=getApp().globalData.top+20,this.top=getApp().globalData.top+getApp().globalData.menuButtonHeight+10;var t=this;t.codetimes=t.i18n.login.getcode},computed:{enabled:function(){if(1==this.loginType){if(this.mobile.length>0&&6==this.code.length)return!1}else if(this.mobile.length>0&&this.password.length>5)return!1;return!0},i18n:function(){return this.$t("index")}},methods:{saveLocal:function(t){console.log(t),getApp().globalData.userinfo=t,e.setStorage({key:"userinfo",data:t,success:function(){console.log("uid存储成功")}});var n=t.im.UserSig,o=t.im.userId;e.$TUIKit.login({userID:o,userSig:n}).then((function(e){console.log("登录成功:",e.data),!0===e.data.repeatLogin&&console.log(e.data.errorInfo)})).catch((function(e){console.warn("login error:",e)})),setTimeout((function(){var n=t.store,o=e.$TUIKit.updateMyProfile({avatar:n.thumb,nick:n.name});o.then((function(e){console.log("更新资料成功")})).catch((function(e){console.warn("更新资料失败:",e)}))}),2e3),this.getUserHomeData(t),setTimeout((function(){e.reLaunch({url:"../index/index"})}),0)},getUserHomeData:function(t){console.log(t);var n=this;n.http.sendRequest("Users.Home",{uid:t.uid,token:t.token}).then((function(t){console.log(t);var n=t.info[0];e.setStorage({key:"shopinfo",data:n,success:function(){console.log("店铺信息存储成功")}}),console.log(n.address);var o=n.address;if(o&&o.length>0){var i={address:n.address,lng:n.lng,lat:n.lat};e.setStorage({key:"shopAddress",data:i,success:function(){console.log("地址存储成功")}})}}))},getSmsCode:function(){var e=this;if(0!=this.canshowcode){var t=this.http.sort2url({mobile:this.mobile,type:1,code:this.countryCode}),n={};n.mobile=this.mobile,n.type=1,n.code=this.countryCode,n.sign=t,this.http.sendRequest("Login.GetCode",n).then((function(t){if(1002==t.code){e.codeFocus=!0;var n=60;e.canshowcode=!1,clearInterval(e.timer),e.timer=null,e.codetimes="(60s)",e.timer=setInterval((function(){n-=1,e.codetimes="("+n+"s)",0==n&&(clearInterval(e.timer),e.timer=null,e.canshowcode=!0,e.codetimes=e.i18n.login.getcode)}),1e3)}}))}},mobileinpit:function(e){1==this.loginType?e.detail.value.length>0?this.canshowcode=!0:this.canshowcode=!1:e.detail.value.length>0?this.passwordFocus=!0:this.passwordFocus=!1},submit:function(){var t,n,o=this;if(o.loginType){if(0==o.mobile.length||0==o.code.length)return}else if(0==o.mobile.length||0==o.password.length)return;1==o.loginType?(t="Login.LoginByCode",n={mobile:o.mobile,code:o.code}):(t="Login.LoginByPass",n={mobile:o.mobile,pass:o.password}),e.showLoading({title:"",mask:!0}),e.login({success:function(i){console.log(i),e.hideLoading(),e.request({url:getApp().globalData.weburl+"api/?s=App.Login.GetMerUnionid",method:"GET",data:{code:i.code},success:function(i){var a=i.data.data.openid;getApp().globalData.openid=a,e.setStorage({key:"openid",data:a,success:function(){}}),o.http.sendRequest(t,n).then((function(e){o.saveLocal(e.info)}))}})},fail:function(e){console.log(e)}})},gotoxieyi:function(t){var n=getApp().globalData.weburl+"appapi/page/detail?id="+t;e.setStorage({key:"weburl",data:n,success:function(){e.navigateTo({url:"../webView/webView"})}})},doBack:function(){e.navigateBack({})},chooseCountry:function(){e.navigateTo({url:"country"})}}};t.default=a}).call(this,n(1)["default"])},73:function(e,t,n){"use strict";n.r(t);var o=n(74),i=n.n(o);for(var a in o)"default"!==a&&function(e){n.d(t,e,(function(){return o[e]}))}(a);t["default"]=i.a},74:function(e,t,n){}},[[67,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/login/login.js.map